<%- include('partials/header') -%>

<div class="container mt-4">
    <h1>Record Detail</h1>
    <% if (error) { %>
    <p><%= message %></p>
    <a href="/" class="btn btn-dark btn-block">Back to Record</a>

    <% } %> <% if (!error) { %>

      <form id="formEdit" data-id="<%= record.id %>">
        <input
          type="text"
          class="form-control my-2"
          name="Item Name"
          value="<%= record.itemName %>"
          id="itemNameInput"
        >
        <input
          type="text"
          class="form-control my-2"
          name="Amount"
          value="<%= record.amount %>"
          id="amountInput"
        >
        <input
        type="text"
        class="form-control my-2"
        name="Date"
        value="<%= record.date %>"
        id="dateInput"
      >
        <button
          class="btn btn-warning btn-block"
          type="submit"
        >
          Edit
        </button>
      </form>

      <hr>

      <button
        class="btn btn-danger btn-sm mt-5"
        id="btnDelete"
        data-id="<%= record.id %>"
      >
        Delete
      </button>

    <% } %>
  </div>

  <%- include('partials/footer.ejs') %>

  <script>
    const btnDelete = document.querySelector('#btnDelete')

    btnDelete.addEventListener('click', async () => {
      console.log('blueprint')
      const id = btnDelete.dataset.id
      console.log('id', id)
      try {
        const data = await fetch(`/${id}`, {
          method: 'delete'
        })
        const res = await data.json()

        if (res.status) {
          window.location.href = '/'
        } else {
          console.log(res)
        }

      } catch (error) {
        console.log(error)
      }
    })


    const formEdit = document.querySelector('#formEdit');
    formEdit.addEventListener('submit', async (e) => {
      e.preventDefault()

      const itemName = document.querySelector('#itemNameInput').value;
      const amount = document.querySelector('#amountInput').value;

      const id = formEdit.dataset.id

      try {

        const data = await fetch(`/${id}`, {
          method: 'put',
          headers: {
            'Content-Type' : 'application/json'
          },
          body: JSON.stringify({itemName, amount})
        })

        const res = await data.json()

        if(res.status){
          window.location.href = '/'
        } else {
          console.log(res)
        }
      } catch (error) {
        console.log(error)
      }
    })
  </script>

<%- include('partials/footer') -%>